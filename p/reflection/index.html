<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='反射的基本使用以及底层原理'><title>Reflection</title>

<link rel='canonical' href='https://minster77.github.io/p/reflection/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Reflection'>
<meta property='og:description' content='反射的基本使用以及底层原理'>
<meta property='og:url' content='https://minster77.github.io/p/reflection/'>
<meta property='og:site_name' content='MinsterBlog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='JavaSE进阶' /><meta property='article:published_time' content='2021-09-05T16:22:25&#43;08:00'/><meta property='article:modified_time' content='2021-09-05T16:22:25&#43;08:00'/>
<meta name="twitter:title" content="Reflection">
<meta name="twitter:description" content="反射的基本使用以及底层原理">
    <link rel="shortcut icon" href="image/M.ico" />

    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://minster77.github.io/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/javaadvanced/" >
                JavaAdvanced
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/reflection/">Reflection</a>
    </h2>

    
    <h3 class="article-subtitle">
        反射的基本使用以及底层原理
    </h3>
    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Sep 05, 2021</time>
    </footer></div>
</header>

    <section class="article-content">
    <h2 id="反射">反射</h2>
<hr>
<ol>
<li>反射机制</li>
<li>class类</li>
<li>类加载</li>
<li>反射获取类的结构信息</li>
<li>通过反射创建对象</li>
<li>练习</li>
</ol>
<hr>
<h3 id="反射机制">反射机制</h3>
<ol>
<li>
<p>引出反射</p>
<ul>
<li>
<p>根据配置文件re.properties指定信息，创建Cat对象并调用方法hi</p>
<p>properties配置文件如下</p>
<pre><code class="language-properties" data-lang="properties">classPath=com.reflection_.Cat
method=hi
</code></pre><p>Cat类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cat</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;jack&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hi</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hi &#34;</span><span class="o">+</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>实现类ReflectionQuestion</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.question</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.reflection_.Cat</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReflectionQuestion</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//1.使用传统方法实现，通过new一个对象，调用方法来实现
</span><span class="c1"></span>        <span class="n">Cat</span> <span class="n">cat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cat</span><span class="o">();</span>
        <span class="n">cat</span><span class="o">.</span><span class="na">hi</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>我们使用传统的方式，能实现上述需求，但如果我们Cat类需要增加功能或者换一种实现时，我们就需要去修改源码了！</p>
<p>所以我们可以尝试使用反射来实现上述需求</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.question</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.reflection_.Cat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Properties</span><span class="o">;</span>
<span class="nd">@SuppressWarnings</span><span class="o">({</span><span class="s">&#34;all&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReflectionQuestion</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>

        <span class="c1">//1.使用properties类，读写配置文件
</span><span class="c1"></span>        <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
        <span class="n">properties</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&#34;src\\re.properties&#34;</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">classfullpath</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;classfullpath&#34;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;method&#34;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;classfullpath = &#34;</span> <span class="o">+</span>  <span class="n">classfullpath</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;methodName = &#34;</span> <span class="o">+</span>  <span class="n">methodName</span><span class="o">);</span>

        <span class="c1">//2.创建对象，发现new的是一个String 错误！！
</span><span class="c1"></span>        <span class="c1">// new classfullpath();
</span><span class="c1"></span>
        <span class="c1">//3.此时就需要使用反射机制来解决了
</span><span class="c1"></span>        <span class="c1">//3.1 加载类，返回class类型的对象cls
</span><span class="c1"></span>        <span class="n">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classfullpath</span><span class="o">);</span>
        <span class="c1">//3.2 通过cls得到你加载的类 com.reflection_.Cat 的对象实例
</span><span class="c1"></span>        <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;o的运行类型 = &#34;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//运行类型
</span><span class="c1"></span>        <span class="c1">//3.3 通过cls得到你加载的类 com.reflection_.Cat 的 methodName 的方法对象
</span><span class="c1"></span>        <span class="c1">//    在反射中，可以把方法视为对象（万物皆对象！）
</span><span class="c1"></span>        <span class="n">Method</span> <span class="n">method1</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
        <span class="c1">//3.4 通过method1 调用方法：即通过方法对象调用方法！
</span><span class="c1"></span>        <span class="n">method1</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>我们可以发现，使用传统方法时：对象.方法()，反射机制：方法.invoke(对象)</p>
<blockquote>
<p>这样的需求在学习框架是特别多，即通过外部文件配置，在不修改源码的情况下，来控制程序，也符合设计模式的OCP原则（开闭原则：不修改源码，扩容功能）。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>反射机制</p>
<ul>
<li>反射机制允许程序在执行期借助于Reflection API取得任何类的内部消息（比如成员变量，构造器，成员方法等等），并且能操作对象的属性及方法。<strong>反射在设计模式和框架底层都会用到</strong></li>
<li>加载完类之后，在堆中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象包含了类的完整结构信息。通过这个对象得到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构，所以，形象的称之为：反射</li>
</ul>
<p>反射机制原理图</p>
<p><img src="/image/Reflection/image01.jpg" alt="image01"  /></p>
<ul>
<li>
<p>Java反射机制可以完成</p>
<ol>
<li>在运行时判断任意一个对象所属的类</li>
<li>在运行时构造任意一个类的对象</li>
<li>在运行时得到任意一个类所具有的成员变量和方法</li>
<li>在运行时调用任意一个对象的成员变量和方法</li>
<li>生产动态代理</li>
</ol>
</li>
<li>
<p>反射相关的主要类：</p>
<ol>
<li>java.lang.Class：代表一个类，Class对象表示某个类加载后在堆中的对象</li>
<li>java.lang.reflect.Method：代表类的方法，Method对象表示某个类的方法</li>
<li>java.lang.reflect.Field：代表类的成员变量，Field对象表示某个类的成员变量</li>
<li>java.lang.reflect.Constructor：代表类的构造方法，Constructor对象表示某个类的构造器</li>
</ol>
<p>代码演示:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Constructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Properties</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author minster
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reflection01</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span><span class="o">,</span> <span class="n">NoSuchFieldException</span> <span class="o">{</span>
        <span class="c1">//1.使用properties类，读写配置文件
</span><span class="c1"></span>        <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
        <span class="n">properties</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&#34;src\\re.properties&#34;</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">classfullpath</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;classfullpath&#34;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;method&#34;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;classfullpath = &#34;</span> <span class="o">+</span>  <span class="n">classfullpath</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;methodName = &#34;</span> <span class="o">+</span>  <span class="n">methodName</span><span class="o">);</span>

        <span class="c1">//3.此时就需要使用反射机制来解决了
</span><span class="c1"></span>        <span class="c1">//3.1 加载类，返回class类型的对象cls
</span><span class="c1"></span>        <span class="n">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classfullpath</span><span class="o">);</span>
        <span class="c1">//3.2 通过cls得到你加载的类 com.reflection_.Cat 的对象实例
</span><span class="c1"></span>        <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="c1">//运行类型
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;o的运行类型 = &#34;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="c1">//3.3 通过cls得到你加载的类 com.reflection_.Cat 的 methodName 的方法对象
</span><span class="c1"></span>        <span class="c1">//    在反射中，可以把方法视为对象（万物皆对象！）
</span><span class="c1"></span>        <span class="n">Method</span> <span class="n">method1</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
        <span class="c1">//3.4 通过method1 调用方法：即通过方法对象调用方法！
</span><span class="c1"></span>        <span class="n">method1</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>

        <span class="c1">//获取Cat类中的某个字段（成员变量），getField不能获取私有属性
</span><span class="c1"></span>        <span class="n">Field</span> <span class="n">age</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getField</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">age</span><span class="o">);</span>

        <span class="c1">//()中能指定构造器参数类型，下面返回无参构造器
</span><span class="c1"></span>        <span class="n">Constructor</span> <span class="n">constructor01</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">constructor01</span><span class="o">);</span>

        <span class="c1">//这里传入的String.class 就是String类的Class对象
</span><span class="c1"></span>        <span class="n">Constructor</span> <span class="n">constructor02</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">constructor02</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/Reflection/image02.jpg" alt="image02"  /></p>
</li>
</ul>
</li>
<li>
<p>反射的优点和缺点</p>
<ul>
<li>优点：可以动态的创建和使用对象（也是框架的底层核心），使用灵活，没有反射机制，框架技术就失去底层支撑</li>
<li>缺点：使用反射基本是解释执行，对执行速度有影响</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author minster
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reflection02</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InvocationTargetException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span> <span class="o">{</span>

        <span class="n">m1</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">m1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.reflection_.Cat&#34;</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">Method</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">900000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">hi</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;耗时：&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/Reflection/image03.jpg" alt="image03"  /></p>
</li>
<li>
<p>反射调用优化-关闭访问检查</p>
<ul>
<li>Method和Field、Constructor对象都有setAccessible()方法</li>
<li>setAccessible作用是启动和禁用访问安全检查的开关</li>
<li><strong>参数值为true表示反射的对象在使用时取消访问检查，提高反射的效率。参数值为false则表示反射的对象执行访问检查。</strong></li>
</ul>
<p>优化代码</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author minster
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reflection02</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InvocationTargetException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span> <span class="o">{</span>

        <span class="n">m1</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">m1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.reflection_.Cat&#34;</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">Method</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">);</span>
        <span class="c1">//关闭反射的访问检测
</span><span class="c1"></span>        <span class="n">hi</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">900000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">hi</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;耗时：&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="o">));</span>


    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/Reflection/image04.jpg" alt="image04"  /></p>
</li>
</ol>
<h3 id="class类">Class类</h3>
<ol>
<li>
<p>基本介绍：</p>
<ul>
<li>
<p>Class类也是类，因此也继承Object类</p>
<p><img src="/image/Reflection/image05.jpg" alt="image05"  /></p>
</li>
<li>
<p>Class类对象不是new出来的，而是系统创建的。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//追源码可以发现是通过ClassLoader类来加载Cat类的Class对象
</span><span class="c1"></span><span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">loadClass</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">loadClass</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>对于某个类的Class类对象，在内存中只有一份，因此类只加载一次</p>
</li>
<li>
<p>每个类的实例都会记得自己是由哪个Class实例所生成</p>
</li>
<li>
<p>通过Class可以完整地得到一个类的完整结构，通过一系列API</p>
<p><img src="/image/Reflection/image06.png" alt="image06"  /></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.class_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.reflection_.Car</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 8:41
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Class02</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchFieldException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">classPath</span> <span class="o">=</span> <span class="s">&#34;com.reflection_.Car&#34;</span><span class="o">;</span>
        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classPath</span><span class="o">);</span>
        <span class="c1">//显示cls对象，是哪个类的Class对象 com.reflection_.cat
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls</span><span class="o">);</span>
        <span class="c1">//输出cls的运行类型 java.lang.Class
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="c1">//创建Class对象的实例,即通过反射获取对象
</span><span class="c1"></span>        <span class="n">Car</span> <span class="n">car</span> <span class="o">=</span> <span class="o">(</span><span class="n">Car</span><span class="o">)</span><span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">car</span><span class="o">);</span>
        <span class="c1">//通过反射获取对象的属性
</span><span class="c1"></span>        <span class="n">Field</span> <span class="n">brand</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getField</span><span class="o">(</span><span class="s">&#34;brand&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">brand</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">car</span><span class="o">));</span>
        <span class="c1">//通过反射获取的字段进行赋值
</span><span class="c1"></span>        <span class="n">brand</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">car</span><span class="o">,</span><span class="s">&#34;奔驰&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">brand</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">car</span><span class="o">));</span>
        <span class="c1">//获取所有属性
</span><span class="c1"></span>        <span class="n">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getFields</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span> <span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">car</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>Class对象时存放在堆的</p>
</li>
<li>
<p>类的字节码二进制数据，是放在方法区的，有的地方称为类的元数据（包括方法代码、变量名、方法名、访问权限等）</p>
</li>
</ul>
</li>
<li>
<p>获取类对象的6种方式</p>
<ol>
<li>
<p>已知一个类的全类名，且在该类的路径下，可以通过Class类的对象的静态方法forName()获取，可能抛出ClassNotFoundException。多用于读取配置文件，读取类全路径，加载类阶段</p>
</li>
<li>
<p>若已知具体的类，通过类的class来获取，该方式最为安全可靠，程序性能最高。多用于参数传递，比如通过反射得到对应构造器对象。</p>
</li>
<li>
<p>若已知某个类的实例，调用该实例的getClass()方法获取Class对象。用于通过创建好的对象，获取Class对象。</p>
</li>
<li>
<p>使用类的加载器来获取类的对象</p>
</li>
<li>
<p>基本数据类型可以通过<code>class cls = int.class</code>获取Class对象</p>
</li>
<li>
<p>基本数据类型对应的包装类，可以通过type获取Class对象</p>
</li>
</ol>
<p>代码演示：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.class_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.reflection_.Car</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 9:30
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetClass</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">classPath</span> <span class="o">=</span> <span class="s">&#34;com.reflection_.Car&#34;</span><span class="o">;</span>
        <span class="c1">//1. 通过Class类的对象的静态方法forName()获取
</span><span class="c1"></span>        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls1</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classPath</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls1</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="c1">//2. 通过类的class来获取
</span><span class="c1"></span>        <span class="n">Class</span> <span class="n">cls2</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="c1">//3. 调用该实例的getClass()方法获取Class对象
</span><span class="c1"></span>        <span class="n">Car</span> <span class="n">car</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Car</span><span class="o">();</span>
        <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Car</span><span class="o">&gt;</span> <span class="n">cls3</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls3</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="c1">//4. 使用类的加载器来获取类的对象
</span><span class="c1"></span>        <span class="c1">//先得到类的加载器
</span><span class="c1"></span>        <span class="n">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">();</span>
        <span class="c1">//再通过类的加载器得到Class对象
</span><span class="c1"></span>        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls4</span> <span class="o">=</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">classPath</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls4</span><span class="o">);</span>
        <span class="c1">//通过hashCode可以看出来他们都是同一个类的对象
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;cls1HashCode = &#34;</span><span class="o">+</span><span class="n">cls1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;cls2HashCode = &#34;</span><span class="o">+</span><span class="n">cls2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;cls3HashCode = &#34;</span><span class="o">+</span><span class="n">cls3</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;cls4HashCode = &#34;</span><span class="o">+</span><span class="n">cls4</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>

        <span class="c1">//5. 通过`class cls = int.class`获取Class对象
</span><span class="c1"></span>        <span class="n">Class</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integerClass</span> <span class="o">=</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">integerClass</span><span class="o">);</span>
        <span class="c1">//6. 通过type获取Class对象
</span><span class="c1"></span>        <span class="n">Class</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">type</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;intHashCode = &#34;</span><span class="o">+</span><span class="n">integerClass</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;IntegerHashCode = &#34;</span><span class="o">+</span><span class="n">type</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>运行结果：</p>
<p><img src="/image/Reflection/image07.jpg" alt="image07"  /></p>
</li>
<li>
<p>在Java中出了基本数据类型有Class对象之外，下面的类型也有Class对象</p>
<p><img src="/image/Reflection/image08.jpg" alt="image08"  /></p>
</li>
</ol>
<h3 id="类加载">类加载</h3>
<ol>
<li>
<p>基本说明</p>
<p>反射机制是java实现动态语言的关键，也就是通过反射实现类动态加载。</p>
<ul>
<li>静态加载：编译时加载相关的类，如果没有则报错，依赖性太强</li>
<li>动态加载：运行时加载需要的类，如果运行时不用该类，则不报错，降低了依赖性</li>
</ul>
<p>代码演示</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.class_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 10:04
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Class03</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;input key&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>

        <span class="k">switch</span> <span class="o">(</span><span class="n">key</span><span class="o">){</span>
            <span class="k">case</span><span class="s">&#34;1&#34;</span><span class="o">:</span>
             <span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
                <span class="n">dog</span><span class="o">.</span><span class="na">cry</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;2&#34;</span> <span class="o">:</span>
             <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ok&#34;</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;3&#34;</span> <span class="o">:</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ok&#34;</span><span class="o">);</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;not do&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">scanner</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>使用cmd进行编译，可以发现即使我们还没传key进去，程序也会报错，因为Dog类是静态加载，因此必须编写Dog类才可以！</p>
<p><img src="/image/Reflection/image09.jpg" alt="image09"  /></p>
<p>此时我们把<code>case 1</code>处的代码注释，使用反射加载类<code>Person</code></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.class_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 10:04
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Class03</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;input key&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>

        <span class="k">switch</span> <span class="o">(</span><span class="n">key</span><span class="o">){</span>
            <span class="k">case</span><span class="s">&#34;1&#34;</span><span class="o">:</span>
<span class="cm">/*                Dog dog = new Dog;
</span><span class="cm">                dog.cry();*/</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;2&#34;</span> <span class="o">:</span>
                <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">person</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;Person&#34;</span><span class="o">);</span>
                <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="n">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">);</span>
                <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;3&#34;</span> <span class="o">:</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ok&#34;</span><span class="o">);</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;not do&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">scanner</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>输出1，可以发现程序能正常执行</p>
<p><img src="/image/Reflection/image10.jpg" alt="image10"  /></p>
<p>输入2，程序抛出异常！这就是所谓的动态加载，当运行时执行到该类的代码时才会使程序异常！</p>
<p><img src="/image/Reflection/image11.jpg" alt="image11"  /></p>
</li>
<li>
<p>类加载时机</p>
<ul>
<li>当创建对象时（new）——静态加载</li>
<li>当子类被加载时——静态加载</li>
<li>调用类中的静态成员时——静态加载</li>
<li>通过反射——动态加载</li>
</ul>
</li>
<li>
<p>类加载过程图</p>
<p><img src="/image/Reflection/image12.jpg" alt="image12"  /></p>
<p>在类加载的三个阶段中，各个阶段会分别完成以下任务</p>
<ul>
<li>
<p>加载（Loading）阶段：JVM在该阶段主要目的是将字节码从不同的数据源（可能是class文件、也可能是jar包，甚至网络）转换为<strong>二进制字节流加载到内存中</strong>，并生成一个代表该类的java.lang.Class对象。</p>
</li>
<li>
<p>连接（Linking）阶段：该阶段包含验证、准备、解析三个阶段</p>
<ul>
<li>
<p>验证阶段：</p>
<ol>
<li>确保被加载的类的正确性，确保你加载的字节码文件没有被恶意地修改过，而且一切都是符合JVM对于字节码格式的要求</li>
<li>在字节码语言层面，Java代码无法做到的事情都是可以实现的，至少语义上可以表达出来的，虚拟机如果不检查输入的字节流，对其完全信任的话，很可能会因为载入了有害的字节流而导致系统崩溃，<strong>所以验证是虚拟机对自身保护的一项重要工作</strong></li>
<li>包括：文件格式验证、元数据验证、字节码验证和符号引用验证</li>
</ol>
</li>
<li>
<p>准备阶段：为类变量赋初值，不给实例变量赋值，这儿的初值指的是零值。例如<code>public static int value = 123;</code></p>
<p>value在准备阶段过后的初始值为<strong>0</strong>而不是123；</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//在准备阶段，属性会如何处理？
</span><span class="c1">//1. n1是实例属性，不是静态变量，因此在准备阶段，是不会分配内存的！
</span><span class="c1">//2. n2是静态变量，分配内存；n2是默认初始化0，而不是20
</span><span class="c1">//3. n3是static final常量，它和静态变量不一样，因为一旦赋值就不会改变，所以n3 = 30；
</span><span class="c1"></span><span class="kd">public</span> <span class="kt">int</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">20</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">30</span><span class="o">;</span>
</code></pre></div></li>
<li>
<p>解析阶段：将常量池的符号引用转化为直接引用，主要针对接口或类，字段。接口方法，类方法的符号引用。</p>
</li>
</ul>
</li>
<li>
<p>初始化（initialization）阶段：<strong>为类的静态变量赋予正确的初始值，即程序员显式地赋予的初始值</strong></p>
<ul>
<li>
<p>到初始化阶段，才真正开始执行类中定义的Java程序代码，此阶段是执行<code>&lt;clinit&gt;()</code>方法的过程。</p>
</li>
<li>
<p><code>&lt;clinit&gt;()</code>方法由编译器按语句在源文件中出现的顺序，<strong>依次自动收集</strong>类中的所有<strong>静态变量</strong>的赋值动作和<strong>静态代码块</strong>中的语句，并进行合并。</p>
</li>
<li>
<p>JVM会保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程环境中被正确加锁、同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的<code>&lt;clinit&gt;()</code>方法，其他线程都需要阻塞等待，知道活动现场执行<code>&lt;clinit&gt;()</code>方法完毕！</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">loadClass</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">resolve</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">ClassNotFoundException</span>
<span class="o">{</span>
    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">getClassLoadingLock</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
         <span class="c1">//省略       
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>我们在创建一个对象时，追源码进去，可以看到在加载类时会有一个方法使用了<code>synchronized</code>锁。<strong>正因如此，才能保证某个类在内存中只有一份Class对象。</strong></p>
</li>
</ul>
<p>如果直接使用类的静态属性，也会导致类的加载</p>
<blockquote>
<p><strong>类加载阶段的深入理解见</strong><a class="link" href="https://blog.csdn.net/qq_34805255/article/details/100829203"  target="_blank" rel="noopener"
    >JVM类加载的深入理解</a></p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3 id="通过反射获取类的结构信息">通过反射获取类的结构信息</h3>
<ul>
<li>
<p>基于<code>java.lang.Class</code>的API</p>
<ol>
<li>getName()：获取全类名。</li>
<li>getSimpleName()：获取简单类名</li>
<li>getFields()：获取所有<code>public</code>修饰的属性，包含本类以及父类（包含Object）的</li>
<li>getDeclaredField()：获取本类中所有属性</li>
<li>getMethods()：获取所有<code>public</code>修饰的方法，包含本类以及父类的</li>
<li>getDeclaredMethods()：获取本类中所有方法</li>
<li>getConstructors()：获取本类所有<code>public</code>修饰的构造器。</li>
<li>getDeclaredConstructors()：获取本类中所有构造器</li>
<li>getPackage()：以Package形式返回包信息</li>
<li>getSuperClass()：以Class形式返回父类信息</li>
<li>getInterfaces()：以Class[]形式返回接口信息</li>
<li>getAnnotations()：以Annotation[]形式返回注解信息</li>
</ol>
</li>
<li>
<p>基于<code>java.lang.reflect.Field</code>类的API</p>
<ol>
<li>
<p>getModifiers()：以int形式返回修饰符**[说明：默认修饰符是0，public是1，private是2，protected是4，static是8，final是16]**</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//如果有一个字段是有多个修饰符，则两个int相加
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;minster&#34;</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">getModifiers</span><span class="o">());</span>
</code></pre></div><p>上面语句会输出<strong>9</strong></p>
</li>
<li>
<p>getType()：以Class形式返回类型</p>
</li>
<li>
<p>getName()：返回属性名</p>
</li>
</ol>
</li>
<li>
<p>基于<code>java.lang.reflect.Method</code>类的API</p>
<ol>
<li>getModifiers()：以int形式返回修饰符**[说明：默认修饰符是0，public是1，private是2，protected是4，static是8，final是16]**</li>
<li>getReturnType()：以Class形式获取返回类型</li>
<li>getName()：返回方法名</li>
<li>getParameterTypes()：以Class[]返回参数类型数组</li>
</ol>
</li>
</ul>
<h3 id="通过反射创建对象">通过反射创建对象</h3>
<ol>
<li>
<p>调用类中的public修饰的无参构造器</p>
</li>
<li>
<p>调用类中的指定构造器</p>
</li>
<li>
<p>Class相关方法</p>
<ul>
<li>
<p>newInstance()：调用类中的无参构造器，获取对应类的对象</p>
</li>
<li>
<p>getConstructor(Class&hellip;clazz)：根据参数列表，获取对应的public构造器对象</p>
</li>
<li>
<p>getDecalaredConstructor(Class&hellip;clazz)：根据参数列表，获取对应的所有构造器</p>
</li>
</ul>
</li>
<li>
<p>Constructor类相关方法</p>
<ul>
<li>setAccessible()：暴破</li>
<li>newInstance(Object&hellip;obj)：调用构造器</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>案例演示</p>
<ul>
<li>通过反射创建某类的对象，要求该类中必须有public的无参构造</li>
<li>通过调用某个特定构造器的方式，实现创建某个类的对象</li>
</ul>
<p>创建User类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 19:36
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;minster&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">21</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="kd">private</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;User{&#34;</span> <span class="o">+</span>
                <span class="s">&#34;name=&#39;&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&#34;, age=&#34;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>创建实现类ReflectionInstance01</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Constructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/22 19:36
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReflectionInstance01</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">classPath</span> <span class="o">=</span> <span class="s">&#34;com.reflection_.User&#34;</span><span class="o">;</span>

        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classPath</span><span class="o">);</span>
        <span class="c1">//1. 通过public的无参构造器创建实例
</span><span class="c1"></span>        <span class="n">Object</span> <span class="n">user1</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>
        <span class="c1">//2. 通过public的有参构造器创建实例
</span><span class="c1"></span>        <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">constructor</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">ming</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&#34;ming&#34;</span><span class="o">,</span> <span class="n">22</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ming</span><span class="o">);</span>
        <span class="c1">//3. 通过非公有的有参构造器创建实例
</span><span class="c1"></span>        <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">declaredConstructor</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">minster</span> <span class="o">=</span> <span class="n">declaredConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&#34;minster&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">minster</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>运行上述代码，我们发现方法1,2都能正常运行，但是方法3却报异常。</p>
<p><img src="/image/Reflection/image13.jpg" alt="image13"  /></p>
<p>因为我们通过<code>getDeclaredConstructor(String.class);</code>获取到的构造器是<code>private</code>的，所以我们在24行访问时会报出<code>IllegalAccessException</code>异常！</p>
<p>此时我们可以使用<strong>暴破</strong>法来解决这个问题</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//3. 通过非公有的有参构造器创建实例
</span><span class="c1">//因为要获取的构造方法为私有的，所以获取到的declaredConstructor也是私有的！
</span><span class="c1"></span><span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">declaredConstructor</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="c1">//暴破（暴力破解，可以使用反射访问private构造器/方法/属性）！
</span><span class="c1"></span><span class="n">declaredConstructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">Object</span> <span class="n">minster</span> <span class="o">=</span> <span class="n">declaredConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&#34;minster&#34;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">minster</span><span class="o">);</span>
</code></pre></div><p>使用<code>java.lang.reflection.Constructor</code>的setAccessible方法可以解决这个问题！</p>
<p><img src="/image/Reflection/image14.jpg" alt="image14"  /></p>
<blockquote>
<p><strong>任何封装的属性在反射面前都是纸老虎！使用暴破可以使反射访问到private构造器/方法/属性</strong></p>
</blockquote>
</li>
<li>
<p><strong>注意：当使用反射访问静态成员或静态方法时，访问的参数可以写成null。（因为静态成员或静态方法属于整个类的属性！）</strong></p>
<p>Student类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">m1</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Reflection04类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/23 9:44
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reflection04</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NoSuchFieldException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">classPath</span> <span class="o">=</span> <span class="s">&#34;com.reflection_.Student&#34;</span><span class="o">;</span>

        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">studentClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">classPath</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">studentClass</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">Field</span> <span class="n">name</span> <span class="o">=</span> <span class="n">studentClass</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
        <span class="c1">//name为私有字段，需要暴破！
</span><span class="c1"></span>        <span class="n">name</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="c1">//给name字段赋值，指定对象为null，因为name字段为static字段
</span><span class="c1"></span>        <span class="n">name</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span><span class="s">&#34;minster&#34;</span><span class="o">);</span>
        <span class="c1">//获取name字段的值
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
        <span class="n">Method</span> <span class="n">declaredMethod</span> <span class="o">=</span> <span class="n">studentClass</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;m1&#34;</span><span class="o">);</span>
        <span class="c1">//因为m1方法属于静态方法，所以可以使用null对象来调用它
</span><span class="c1"></span>        <span class="n">Object</span> <span class="n">o1</span> <span class="o">=</span> <span class="n">declaredMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>在反射中，如果方法有返回值，统一返回Object！</p>
<p><img src="/image/Reflection/image15.jpg" alt="image15"  /></p>
</li>
</ul>
<h3 id="练习">练习</h3>
<ul>
<li>
<p>利用反射创建文件</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.reflection_.homework</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Constructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/9/23 10:33
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeWork02</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">InvocationTargetException</span><span class="o">,</span> <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">IllegalAccessException</span> <span class="o">{</span>

        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">fileClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;java.io.File&#34;</span><span class="o">);</span>
        <span class="n">Constructor</span><span class="o">&lt;?&gt;[]</span> <span class="n">declaredConstructor</span> <span class="o">=</span> <span class="n">fileClass</span><span class="o">.</span><span class="na">getDeclaredConstructors</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">constructor</span> <span class="o">:</span> <span class="n">declaredConstructor</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;File的构造器有：&#34;</span><span class="o">+</span><span class="n">constructor</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">declaredConstructor1</span> <span class="o">=</span> <span class="n">fileClass</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Method</span> <span class="n">createNewFile</span> <span class="o">=</span> <span class="n">fileClass</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;createNewFile&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">allPath</span> <span class="o">=</span> <span class="s">&#34;e:\\mynew.txt&#34;</span><span class="o">;</span>
        <span class="n">Object</span> <span class="n">file</span> <span class="o">=</span> <span class="n">declaredConstructor1</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">allPath</span><span class="o">);</span>
        <span class="n">createNewFile</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/Reflection/image16.jpg" alt="image16"  /></p>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/javase%E8%BF%9B%E9%98%B6/">JavaSE进阶</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/java_io%E6%B5%81_2/">
        
        

        <div class="article-details">
            <h2 class="article-title">Java_IO流_2</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/java%E6%B3%9B%E5%9E%8B/">
        
        

        <div class="article-details">
            <h2 class="article-title">Java泛型</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/java_io%E6%B5%81/">
        
        

        <div class="article-details">
            <h2 class="article-title">Java_IO流</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/javainterface/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaInterface</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/java%E5%86%85%E9%83%A8%E7%B1%BB/">
        
        

        <div class="article-details">
            <h2 class="article-title">Java内部类</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src="https://utteranc.es/client.js" 
        repo="minster77/hugoblogtalks"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2021 MinsterBlog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.4.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#反射">反射</a>
      <ol>
        <li><a href="#反射机制">反射机制</a></li>
        <li><a href="#class类">Class类</a></li>
        <li><a href="#类加载">类加载</a></li>
        <li><a href="#通过反射获取类的结构信息">通过反射获取类的结构信息</a></li>
        <li><a href="#通过反射创建对象">通过反射创建对象</a></li>
        <li><a href="#练习">练习</a></li>
      </ol>
    </li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
