<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Spring的注解使用及整合MyBatis'><title>Spring（二）</title>

<link rel='canonical' href='https://minster77.github.io/p/spring%E4%BA%8C/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Spring（二）'>
<meta property='og:description' content='Spring的注解使用及整合MyBatis'>
<meta property='og:url' content='https://minster77.github.io/p/spring%E4%BA%8C/'>
<meta property='og:site_name' content='MinsterBlog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='SSM' /><meta property='article:published_time' content='2021-10-04T16:22:25&#43;08:00'/><meta property='article:modified_time' content='2021-10-04T16:22:25&#43;08:00'/>
<meta name="twitter:title" content="Spring（二）">
<meta name="twitter:description" content="Spring的注解使用及整合MyBatis">
    <link rel="shortcut icon" href="image/M.ico" />

    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://minster77.github.io/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ssm/" >
                SSM
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/spring%E4%BA%8C/">Spring（二）</a>
    </h2>

    
    <h3 class="article-subtitle">
        Spring的注解使用及整合MyBatis
    </h3>
    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Oct 04, 2021</time>
    </footer></div>
</header>

    <section class="article-content">
    <h2 id="spring二">Spring（二）</h2>
<h3 id="beaen的自动装配">Beaen的自动装配</h3>
<ul>
<li>自动装配是Spring满足Bean依赖的一种方式</li>
<li>Spring会在上下文中自动寻找，并自动给Bean装配属性</li>
</ul>
<ol>
<li>
<p><strong>byName自动装配</strong></p>
<p>byName：会自动在容器上下文中查找和自己对象set方法后面的值对应的bean id</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cat&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dog&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;person&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Person&#34;</span> <span class="na">autowire=</span><span class="s">&#34;byName&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;name&#34;</span> <span class="na">value=</span><span class="s">&#34;jack&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><p>使用byName时，需要保证所有bean的id唯一，并且这个bean需要和自动注入的属性的set方法的值一致！</p>
</li>
<li>
<p><strong>byType自动装配</strong></p>
<p>byType：会自动在容器上下文中查找和自己对象属性类型相同的bean</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cat&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dog&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;person&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Person&#34;</span> <span class="na">autowire=</span><span class="s">&#34;byType&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;name&#34;</span> <span class="na">value=</span><span class="s">&#34;jack&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><p>使用byType时，需要保证所有bean的class唯一，并且这个bean需要和自动注入的属性的类型一致！</p>
</li>
<li>
<p>使用注解实现自动装配</p>
<p>要使用注解，则需要做以下准备工作：</p>
<ol>
<li>
<p>导入约束</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
    <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">        https://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">        http://www.springframework.org/schema/context
</span><span class="s">        https://www.springframework.org/schema/context/spring-context.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;context:annotation-config/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></li>
<li>
<p>配置注解的支持</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:annotation-config/&gt;</span>
</code></pre></div></li>
</ol>
<p><strong>@Autowired</strong></p>
<ul>
<li>
<p>该注解对类的成员变量、方法及构造方法进行标注，完成自动装配工作。**其作用是为了消除代码Java代码里面的getter/setter与bean属性中的property。**当然，getter看个人需求，如果私有属性需要对外提供的话，应当予以保留。</p>
</li>
<li>
<p>该注解是按类型自动装配的，不支持id匹配</p>
</li>
<li>
<p>代码测试：</p>
<p>将User类中的set方法去掉，使用@Autowired注解</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 8:56
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Dog</span> <span class="n">dog</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Cat</span> <span class="nf">getCat</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cat</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Dog</span> <span class="nf">getDog</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dog</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>此时配置文件的内容为</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cat1&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dog1&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;person&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Person&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</code></pre></div><p>编写测试代码，成功输出结果！</p>
</li>
<li>
<p>扩展：当@Autowired(required=false)的时候，说明对象可以为null；@Autowired注解中该属性默认为true，即对象不能为null</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Target</span><span class="o">({</span><span class="n">ElementType</span><span class="o">.</span><span class="na">CONSTRUCTOR</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">ANNOTATION_TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Autowired</span> <span class="o">{</span>

   <span class="cm">/**
</span><span class="cm">    * Declares whether the annotated dependency is required.
</span><span class="cm">    * &lt;p&gt;Defaults to {@code true}.
</span><span class="cm">    */</span>
   <span class="kt">boolean</span> <span class="nf">required</span><span class="o">()</span> <span class="k">default</span> <span class="kc">true</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div><p>如果允许对象为null，设置required = false,默认为true</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Autowired</span><span class="o">(</span><span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>
</code></pre></div></li>
</ul>
<p><strong>@Qualifier</strong></p>
<ul>
<li>@Autowired是根据类型自动装配的，加上@Qualifier则可以根据byName的方式自动装配</li>
<li>@Qualifier不能单独使用</li>
</ul>
<p>代码测试：</p>
<ol>
<li>
<p>修改配置文件内容，保证类型存在对象。且名字不为类的默认名字！</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cat1&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cat2&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dog1&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dog2&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;person&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.pojo.Person&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</code></pre></div><p>此时我们使用@Autowired注解来标记对象，测试，程序报错</p>
<p><img src="/image/SpringImage/image09.jpg" alt="image09"  /></p>
</li>
<li>
<p>在属性上添加@Qualifier注解</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;cat1&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>
<span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;dog2&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Dog</span> <span class="n">dog</span><span class="o">;</span>
</code></pre></div><p>再进行测试，成功输出！</p>
<p><img src="/image/SpringImage/image10.jpg" alt="image10"  /></p>
</li>
</ol>
<p><strong>@Resource</strong></p>
<ul>
<li>@Resource如果指定的name属性，则先按该属性进行byName方式进行查找装配</li>
<li>其次再进行默认的byName方式进行装配</li>
<li>如果以上都不成功，则按byType的方式进行自动装配</li>
</ul>
<p>代码测试</p>
<ol>
<li>
<p>修改Person中的代码</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//指定name的属性
</span><span class="c1"></span><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;cat1&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>
<span class="nd">@Resource</span>
<span class="kd">private</span> <span class="n">Dog</span> <span class="n">dog</span><span class="o">;</span>
</code></pre></div></li>
<li>
<p>配置文件代码</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">context</span><span class="o">:</span><span class="n">annotation</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;&lt;/</span><span class="n">context</span><span class="o">:</span><span class="n">annotation</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;cat1&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;cat2&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.heng.pojo.Cat&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;dog1&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.heng.pojo.Dog&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</code></pre></div><p>测试，成功输出结果</p>
<p><img src="/image/SpringImage/image10.jpg" alt="image10"  /></p>
</li>
</ol>
</li>
<li>
<p><strong>小结：</strong></p>
<p>@Autowired与@Resource异同：</p>
<ol>
<li>@Autowired与@Resource都可以用来装配bean。都可以写在字段或setter方法上。</li>
<li>@Autowired默认按照类型装配（属于Spring规范），默认情况下必须要求依赖对象必须存在，如果要允许null值，可以设置它的required属性为false，如<code>@Autowired(required = false)</code>，如果我们想使用byName完成自动装配，则可以结合@Quaalifier注解进行使用</li>
<li>@Resource（属于J2EE复返），默认按照名称进行装配，名称可以通过name属性进行指定。如果没有指定name属性，当注解写在字段上时，默认取字段名进行按照名称查找，如果注解写在setter方法上默认取属性名进行装配。当找不到与名称匹配的bean时才按照类型进行装配。但是需要注意的是，如果name属性一旦指定，就只会按照名称进行装配。</li>
</ol>
<p><strong>它们的作用相同都是用注解方式注入对象，但执行顺序不同。@Autowired先byType，@Resource先byName。</strong></p>
</li>
</ol>
<h3 id="使用注解开发">使用注解开发</h3>
<p>常用的注解有：</p>
<ul>
<li><strong>@Component</strong> 是所有受Spring 管理组件的通用形式，@Component注解可以放在类的头上，@Component不推荐使用。</li>
<li><strong>@Controller</strong> 通过@Controller注解说明该类非普通类，而是一个控制器类。</li>
<li><strong>@Repository</strong> 用于注解dao层，在daoImpl类上面注解。</li>
<li><strong>@Service</strong> 用于注解Service层，在ServiceImpl类上面注解。</li>
<li><strong>@RequestMapping</strong> 通过RequestMapping注解映射请求URL</li>
<li><strong>@Autowired</strong>默认按类型匹配的方式，在容器查找匹配的Bean，当有且仅有一个匹配的Bean时，Spring将其注入@Autowired标注的变量中。</li>
<li><strong>@Scope</strong> 设置Spring容器如何新建Bean实例（方法上，得有@Bean）
<ul>
<li>Singleton （单例,一个Spring容器中只有一个bean实例，默认模式）</li>
<li>Protetype （每次调用新建一个bean）</li>
<li>Request （web项目中，给每个http request新建一个bean）</li>
<li>Session （web项目中，给每个http session新建一个bean）</li>
<li>GlobalSession（给每一个 global http session新建一个Bean实例）</li>
</ul>
</li>
</ul>
<p>在Spring4之后，要使用注解开发，需要导入AOP的包</p>
<p><img src="/image/SpringImage/image11.jpg" alt="image11"  /></p>
<p>在配置文件中，还需要引入一个context约束</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">       http://www.springframework.org/schema/context
</span><span class="s">       http://www.springframework.org/schema/context/spring-context.xsd&#34;</span><span class="nt">&gt;</span>
    
	<span class="c">&lt;!--指定注解扫描包--&gt;</span>
    
    <span class="nt">&lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><p>代码测试：</p>
<ol>
<li>
<p>编写User类，添加注解</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 15:08
</span><span class="cm"> */</span>
<span class="c1">//相当于配置文件中的 &lt;bean id=&#34;user&#34; class=&#34;com.heng.pojo.User&gt;
</span><span class="c1"></span><span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;jack&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>在xml配置文件中加入指定注解扫描包</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--指定注解扫描包--&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.heng.pojo&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
<span class="c">&lt;!--支持注解--&gt;</span>
<span class="nt">&lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span>
</code></pre></div></li>
<li>
<p>编写测试类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test01</span><span class="o">(){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;application.xml&#34;</span><span class="o">);</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>成功输出</p>
</li>
</ol>
<p>使用注解注入属性：</p>
<ol>
<li>
<p>可以不用提供set方法，直接在属性上面添加@Value(&ldquo;值&rdquo;)注解</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/** 相当于配置文件中的 
</span><span class="cm"> * &lt;bean id=&#34;user&#34; class=&#34;com.heng.pojo.User&gt;
</span><span class="cm"> *  &lt;property name=&#34;name&#34; value=&#34;jack&#34;&gt;&lt;/property&gt;
</span><span class="cm"> * &lt;/bean&gt;
</span><span class="cm">* */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;jack&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">;</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>如果提供了set方法，可以在set方法上添加Value(&ldquo;值&rdquo;)；</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
<span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;10&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>测试结果：</p>
<p><img src="/image/SpringImage/image12.png" alt="image12"  /></p>
</li>
</ol>
<p><strong>小结</strong>：</p>
<ul>
<li>XML与注解比较
<ul>
<li>XML可以适用任何场景，结构清晰，维护方便</li>
<li>注解不是自己提供的类适用不了，开发简单方便</li>
</ul>
</li>
<li>xml与注解整合开发：推荐最佳实践！
<ul>
<li>xml管理bean</li>
<li>注解完成属性注入</li>
<li>适用过程中，可以不用扫描，扫描是为了类上的注解</li>
</ul>
</li>
<li><code>&lt;context:annotation-config/&gt;  </code>作用
<ul>
<li>进行注解驱动注册，从而使注解生效</li>
<li>用于激活那些已经在Spring容器里注册过的Bean上面的注解，也就是显示的向Spring注册</li>
<li>如果不扫描包，就需要手动配置bean</li>
<li>如果不加载注解驱动，则注入的值为Null</li>
</ul>
</li>
</ul>
<p><strong>基于Java类进行配置</strong></p>
<ul>
<li>
<p>JavaConfig原本是Spring的一个子项目，它通过Java类的方式提供了Bean的定义信息，在Spring4的版本，JavaConfig已正式成为Spring4的核心功能！</p>
<p><img src="/image/SpringImage/image15.jpg" alt="image15"  /></p>
</li>
<li>
<p>代码测试</p>
<ol>
<li>
<p>编写一个实体类Dog</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dog</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;dog&#34;</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></li>
<li>
<p>新建一个Config包，编写配置类MyConfig</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//Configuration代表这是一个配置类
</span><span class="c1"></span><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig</span> <span class="o">{</span>
    <span class="c1">//通过方法注册一个bean，这里的返回值就Bean的类型，方法名就是bean的id！
</span><span class="c1"></span>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Dog</span> <span class="nf">dog</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>编写测试方法</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test02</span><span class="o">(){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">MyConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="o">(</span><span class="n">Dog</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;dog&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dog</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>测试结果：</p>
<p><img src="/image/SpringImage/image13.jpg" alt="image13"  /></p>
</li>
<li>
<p>注意：如果需要对实体类的属性进行注入，使用@Value(&ldquo;值&rdquo;)注解即可</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 15:38
</span><span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dog</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;dog&#34;</span><span class="o">;</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;10&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/SpringImage/image14.jpg" alt="image14"  /></p>
</li>
</ol>
</li>
</ul>
<p>如果此时需要导入其他类，我们可以使用<code>@Import</code></p>
<ol>
<li>
<p>其他配置类MyConfig2</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig2</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>修改MyConfig</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.heng.pojo.Dog</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 15:39
</span><span class="cm"> */</span>
<span class="nd">@SuppressWarnings</span><span class="o">({</span><span class="s">&#34;all&#34;</span><span class="o">})</span>
<span class="c1">//Configurationd代表这是一个配置类
</span><span class="c1"></span><span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">MyConfig2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig</span> <span class="o">{</span>
    <span class="c1">//通过方法注册一个bean，这里的返回值就Bean的类型，方法名就是bean的id！
</span><span class="c1"></span>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Dog</span> <span class="nf">dog</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>关于这种Java类的配置方式，我们在之后的SpringBoot 和 SpringCloud中还会大量看到，我们需要知道这些注解的作用即可~</p>
</li>
</ol>
<h3 id="aop">AOP</h3>
<ul>
<li>
<p><strong>什么是AOP</strong></p>
<p>AOP（Aspect Oriented Programming）：面向切面编程，能够将那些与业务无关，却为业务模块所共同调用的逻辑或责任（例如事务处理、日志管理、权限控制等）封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可拓展性和可维护性。</p>
<p>Spring AOP就是基于动态代理的，如果要代理的对象，实现了某个接口，那么Spring AOP就会使用<strong>JDK Proxy</strong>，去创建代理对象，而对没有实现接口的对象，就<strong>无法使用JDK Proxy去进行代理了</strong>，这时候Spring AOP就会使用<strong>Cglib</strong>生成一个被代理对象的子类来作为代理，如下图所示：</p>
<p><img src="/image/SpringImage/image16.jpg" alt="image16"  /></p>
<p>当然你也可以使用 <strong>AspectJ</strong> ！Spring AOP 已经集成了 AspectJ ，AspectJ 应该算的上是 Java 生态系统中最完整的 AOP 框架了。</p>
</li>
<li>
<p><strong>AOP的相关名词</strong></p>
<ul>
<li>横切关注点：跨越应用程序多个模块的方法或功能。即是，与我们业务逻辑无关的，但是我们需要关注的部分，就是横切关注点。如日志 , 安全 , 缓存 , 事务等等 &hellip;.</li>
<li>切面（ASPECT）：横切关注点 被模块化 的特殊对象。即，它是一个类。</li>
<li>通知（Advice）：切面必须要完成的工作。即，它是类中的一个方法。</li>
<li>目标（Target）：被通知对象。</li>
<li>代理（Proxy）：向目标对象应用通知之后创建的对象。</li>
<li>切入点（PointCut）：切面通知 执行的 “地点”的定义。</li>
<li>连接点（JointPoint）：与切入点匹配的执行点。</li>
</ul>
</li>
<li>
<p>现在我们举一个例子来理解什么是AOP</p>
<p><strong>AOP：Aspect oriented programming 面向切面编程，AOP 是 OOP（面向对象编程）的一种延续。</strong></p>
<p>例如：现有三个类：<code>Horse</code>、<code>Pig</code>、<code>Dog</code>，这三个类中都有eat和run两个方法</p>
<p>通过OOP思想中的继承，我们可以提取出一个Animal的父类，然后将eat和run方法放入父类中，<code>Horse</code>、<code>Pig</code>、<code>Dog</code>通过继承<code>Animal</code>类即可自动获得<code>eat()</code>和<code>run()</code>方法。这样将会少写很多代码。</p>
<p><img src="/image/SpringImage/image17.jpg" alt="image17"  /></p>
<p>OOP 编程思想可以解决大部分的代码重复问题。但是有一些问题是处理不了的。比如在父类 Animal 中的多个方法的相同位置出现了重复的代码，OOP 就解决不了。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * 动物父类
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Animal</span> <span class="o">{</span>

    <span class="cm">/** 身高 */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">height</span><span class="o">;</span>

    <span class="cm">/** 体重 */</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">weight</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">eat</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 性能监控代码
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

        <span class="c1">// 业务逻辑代码
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;I can eat...&#34;</span><span class="o">);</span>

        <span class="c1">// 性能监控代码
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;执行时长：&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">)/</span><span class="n">1000f</span> <span class="o">+</span> <span class="s">&#34;s&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 性能监控代码
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

        <span class="c1">// 业务逻辑代码
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;I can run...&#34;</span><span class="o">);</span>

        <span class="c1">// 性能监控代码
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;执行时长：&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">)/</span><span class="n">1000f</span> <span class="o">+</span> <span class="s">&#34;s&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>这部分重复的代码，一般统称为 <strong>横切逻辑代码</strong>。</p>
<p><img src="/image/SpringImage/image18.jpg" alt="image18"  /></p>
<p>横切逻辑代码存在的问题：</p>
<ul>
<li>代码重复问题</li>
<li>横切逻辑代码和业务代码混杂在一起，代码臃肿，不变维护</li>
</ul>
<p><strong>AOP就是用来解决这些问题的！</strong></p>
<p>AOP 另辟蹊径，提出横向抽取机制，将横切逻辑代码和业务逻辑代码分离</p>
<p><img src="/image/SpringImage/image19.jpg" alt="image19"  /></p>
<p>代码拆分比较容易，难的是如何在不改变原有业务逻辑的情况下，悄无声息的将横向逻辑代码应用到原有的业务逻辑中，达到和原来一样的效果。</p>
</li>
<li>
<p><strong>AOP 解决了什么问题</strong></p>
<p>通过上面的分析可以发现，AOP 主要用来解决：在不改变原有业务逻辑的情况下，增强横切逻辑代码，根本上解耦合，避免横切逻辑代码重复。</p>
</li>
<li>
<p><strong>AOP 为什么叫面向切面编程</strong></p>
<p><strong>切</strong> ：指的是横切逻辑，原有业务逻辑代码不动，只能操作横切逻辑代码，所以面向横切逻辑</p>
<p><strong>面</strong> ：横切逻辑代码往往要影响的是很多个方法，每个方法如同一个点，多个点构成一个面。这里有一个面的概念</p>
</li>
</ul>
<p>在AOP中，通过Advice定义横切逻辑，Spring中支持5中类型的Advice：</p>
<p><img src="/image/SpringImage/image20.jpg" alt="image20"  /></p>
<p>即 Aop 在 不改变原有代码的情况下 , 去增加新的功能 .</p>
<ul>
<li>
<p>使用Spring来实现AOP</p>
<ol>
<li>
<p>导入新的相关依赖包</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>1.9.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></li>
</ol>
<p><strong>第一种实现方式：通过Spring API实现</strong></p>
<ul>
<li>
<p>编写业务接口和实现类</p>
<p>UserService业务接口：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.service</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 19:45
</span><span class="cm"> */</span>
<span class="nd">@SuppressWarnings</span><span class="o">({</span><span class="s">&#34;all&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div><p>UserServiceImpl接口实现类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.service</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/25 19:45
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;增加了一个用户&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;删除了一个用户&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;更新了一个用户&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;查询了一个用户&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>编写横切逻辑代码（就是增强类 , 我们编写两个 , 一个前置增强 一个后置增强）</p>
<p>前置增强类BeforeLog</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.aop.MethodBeforeAdvice</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

   <span class="c1">//method : 要执行的目标对象的方法
</span><span class="c1"></span>   <span class="c1">//args : 被调用的方法的参数
</span><span class="c1"></span>   <span class="c1">//target : 目标对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeforeLog</span> <span class="kd">implements</span> <span class="n">MethodBeforeAdvice</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(</span><span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">,</span> <span class="n">Object</span> <span class="n">target</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">&#34;的&#34;</span><span class="o">+</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()+</span><span class="s">&#34;方法被执行了&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>后置增强类AfterLog</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.aop.AfterReturningAdvice</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

   <span class="c1">//returnValue 返回值
</span><span class="c1"></span>   <span class="c1">//method被调用的方法
</span><span class="c1"></span>   <span class="c1">//args 被调用的方法的对象的参数
</span><span class="c1"></span>   <span class="c1">//target 被调用的目标对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AfterLog</span> <span class="kd">implements</span> <span class="n">AfterReturningAdvice</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturning</span><span class="o">(</span><span class="n">Object</span> <span class="n">returnValue</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">,</span> <span class="n">Object</span> <span class="n">target</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;执行了&#34;</span> <span class="o">+</span> <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">&#34;的&#34;</span><span class="o">+</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()+</span><span class="s">&#34;方法,&#34;</span><span class="o">+</span><span class="s">&#34;返回值:&#34;</span><span class="o">+</span><span class="n">returnValue</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>最后去spring的文件中注册 , 并实现aop切入实现 , 注意导入约束 .</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">       http://www.springframework.org/schema/aop
</span><span class="s">       http://www.springframework.org/schema/aop/spring-aop.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--注册Bean--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.service.UserServiceImpl&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;afterLog&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.log.AfterLog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;beforeLog&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.log.BeforeLog&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
    <span class="c">&lt;!--AOP配置--&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="c">&lt;!--切入点 expression：表达式匹配要执行的方法,execution(要执行的位置 * * * * *)
</span><span class="c">          execution(修饰符(一般省略)  返回值  包.类.方法名(参数) throws异常(一般省略))--&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;pointcut&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* com.heng.service.UserServiceImpl.*(..))&#34;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!--执行环绕:advice-ref 执行方法，pointcut-ref 切入点--&gt;</span>
        <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;afterLog&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;pointcut&#34;</span><span class="nt">&gt;&lt;/aop:advisor&gt;</span>
        <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;beforeLog&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;pointcut&#34;</span><span class="nt">&gt;&lt;/aop:advisor&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><p>测试方法</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAop</span><span class="o">(){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="o">);</span>
    <span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userService&#34;</span><span class="o">,</span> <span class="n">UserService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div><p>运行结果：</p>
<p><img src="/image/SpringImage/image21.jpg" alt="image21"  /></p>
<blockquote>
<p>Spring的Aop就是将公共的业务 (日志 , 安全等) 和领域业务结合起来 , 当执行领域业务时 , 将会把公共业务加进来 . 实现公共业务的重复利用 . 领域业务更纯粹 , 程序猿专注领域业务 , 其本质还是动态代理 .</p>
</blockquote>
</li>
</ul>
<p><strong>第二种方式：自定义类来实现AOP</strong></p>
<p>目标业务类不变依旧是userServiceImpl</p>
<ol>
<li>
<p>写我们自己的一个切入类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DiyPointcut</span> <span class="o">{</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;---------方法执行前---------&#34;</span><span class="o">);</span>
  <span class="o">}</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">after</span><span class="o">(){</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;---------方法执行后---------&#34;</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></li>
<li>
<p>去applicationContext中配置</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--第二种方式自定义实现--&gt;</span>
<span class="c">&lt;!--注册bean--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;diy&#34;</span> <span class="na">class=</span><span class="s">&#34;com.kuang.config.DiyPointcut&#34;</span><span class="nt">/&gt;</span>

<span class="c">&lt;!--aop的配置--&gt;</span>
<span class="nt">&lt;aop:config&gt;</span>
   <span class="c">&lt;!--第二种方式：使用AOP的标签实现--&gt;</span>
   <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">&#34;diy&#34;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;diyPonitcut&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* com.kuang.service.UserServiceImpl.*(..))&#34;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;aop:before</span> <span class="na">pointcut-ref=</span><span class="s">&#34;diyPonitcut&#34;</span> <span class="na">method=</span><span class="s">&#34;before&#34;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;aop:after</span> <span class="na">pointcut-ref=</span><span class="s">&#34;diyPonitcut&#34;</span> <span class="na">method=</span><span class="s">&#34;after&#34;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/aop:aspect&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>
</code></pre></div></li>
<li>
<p>测试，成功输出！</p>
</li>
</ol>
<p><strong>第三种方式：使用注解完成</strong></p>
<ol>
<li>
<p>编写一个注解实现的增强类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.After</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Around</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Before</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Author: minster
</span><span class="cm"> * @Date: 2021/10/26 8:08
</span><span class="cm"> */</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnnotationPointcut</span> <span class="o">{</span>
    <span class="nd">@Before</span><span class="o">(</span><span class="s">&#34;execution(* com.heng.service.UserServiceImpl.*(..))&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;方法执行前&#34;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@After</span><span class="o">(</span><span class="s">&#34;execution(* com.heng.service.UserServiceImpl.*(..))&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">after</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;方法执行后&#34;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Around</span><span class="o">(</span><span class="s">&#34;execution(* com.heng.service.UserServiceImpl.*(..))&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">around</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">jp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;环绕前&#34;</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">proceed</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;环绕后&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>在配置文件中，注册Bean，并增加支持注解的配置</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;annotationPointcut&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.config.AnnotationPointcut&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span>
</code></pre></div><p>aop:aspectj-autoproxy：说明</p>
<blockquote>
<p><strong>通过aop命名空间的<code>&lt;aop:aspectj-autoproxy /&gt;</code>声明自动为spring容器中那些配置<code>@aspectJ</code>切面的bean创建代理，织入切面。当然，spring 在内部依旧采用<code>AnnotationAwareAspectJAutoProxyCreator</code>进行自动代理的创建工作，但具体实现的细节已经被<code>&lt;aop:aspectj-autoproxy /&gt;</code>隐藏起来了</strong></p>
<p><strong><code>&lt;aop:aspectj-autoproxy /&gt;</code>有一个<code>proxy-target-class</code>属性，默认为<code>false</code>，表示使用jdk动态代理织入增强</strong></p>
<p><strong>当配为<code>&lt;aop:aspectj-autoproxy  poxy-target-class=&quot;true&quot;/&gt;</code>时，表示使用CGLib动态代理技术织入增强。不过即使<code>proxy-target-class</code>设置为<code>false</code>，如果目标类没有声明接口，则spring将自动使用CGLib动态代理。</strong></p>
</blockquote>
</li>
<li>
<p>测试，成功输出</p>
</li>
</ol>
<p>**注意：**使用注解增强类完成切入时，<strong>切入顺序为<code>环绕前-&gt;方法执行前-&gt;方法-&gt;方法执行后-&gt;环绕后</code></strong></p>
</li>
</ul>
<h3 id="整合mybatis">整合MyBatis</h3>
<p>要和 Spring 一起使用 MyBatis，需要在 Spring 应用上下文中定义至少两样东西：一个 <strong>SqlSessionFactory</strong> 和至少一个<strong>数据映射器类。</strong></p>
<p>在 MyBatis-Spring 中，可使用<strong>SqlSessionFactoryBean来创建 SqlSessionFactory</strong>。要配置这个工厂 bean，只需要把下面代码放在 Spring 的 XML 配置文件中：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSessionFactory&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;configLocation&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:mybatis-config.xml&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mapperLocations&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:com/heng/dao/UserMapper.xml&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;/bean&gt;</span>
</code></pre></div><p>注意：SqlSessionFactory需要一个 DataSource（数据源）。这可以是任意的 DataSource，只需要和配置其它 Spring 数据库连接一样配置它就可以了。</p>
<blockquote>
<p>在基础的 MyBatis 用法中，是<strong>通过 SqlSessionFactoryBuilder 来创建 SqlSessionFactory 的</strong>。而在 MyBatis-Spring 中，则使用 <strong>SqlSessionFactoryBean 来创建</strong>。</p>
</blockquote>
<ul>
<li>
<p>在 MyBatis 中，你可以使用 SqlSessionFactory 来创建 SqlSession。一旦你获得一个 session 之后，你可以使用它来执行映射了的语句，提交或回滚连接，最后，当不再需要它的时候，你可以关闭 session。</p>
</li>
<li>
<p>SqlSessionFactory有一个唯一的必要属性：用于 JDBC 的 DataSource。这可<strong>以是任意的 DataSource 对象</strong>，它的配置方法和其它 Spring 数据库连接是一样的。</p>
</li>
<li>
<p>一个<strong>常用的属性是 configLocation</strong>，它用来<strong>指定 MyBatis 的 XML 配置文件路径</strong>。它在需要修改 MyBatis 的基础配置非常有用。通常，<strong>基础配置指的是 <code>&lt; settings&gt;</code> 或 <code>&lt; typeAliases&gt;</code>元素</strong>。</p>
<blockquote>
<p>需要注意的是，这个配置文件并不需要是一个完整的 MyBatis 配置。确切地说，任何环境配置（<code>&lt;environments&gt;</code>），数据源（<code>&lt;DataSource&gt;</code>）和 MyBatis 的事务管理器（<code>&lt;transactionManager&gt;</code>）都会被忽略。SqlSessionFactoryBean 会创建它自有的 MyBatis 环境配置（Environment），并按要求设置自定义环境的值。</p>
</blockquote>
</li>
</ul>
<p><strong>SqlSessionTemplate</strong> 是 MyBatis-Spring 的核心。作为 SqlSession 的一个实现，这意味着可以使用它无缝代替你代码中已经在使用的 SqlSession。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">SqlSessionTemplate</span><span class="o">(</span><span class="n">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">sqlSessionFactory</span><span class="o">,</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getDefaultExecutorType</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div><p><strong>模板可以参与到 Spring 的事务管理中，并且由于其是线程安全的</strong>，可以供多个映射器类使用，你应该总是用 SqlSessionTemplate 来替换 MyBatis 默认的 DefaultSqlSession 实现。在同一应用程序中的不同类之间混杂使用可能会引起数据一致性的问题。</p>
<p>可以使用 SqlSessionFactory 作为构造方法的参数来创建 SqlSessionTemplate 对象。</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionTemplate&#34;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&#34;0&#34;</span> <span class="na">ref=</span><span class="s">&#34;sqlSessionFactory&#34;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div><p>现在，这个 bean 就可以直接注入到你的 DAO bean 中了。你需要在你的 bean 中添加一个 SqlSession 属性，就像下面这样：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="n">SqlSession</span> <span class="n">sqlSession</span><span class="o">;</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSqlSession</span><span class="o">(</span><span class="n">SqlSession</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">sqlSession</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">;</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">UserMapper</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getUser</span><span class="o">();</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>按下面这样，注入 SqlSessionTemplate：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userDao&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.sample.dao.UserDaoImpl&#34;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">ref=</span><span class="s">&#34;sqlSession&#34;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div><p>图示：</p>
<p><img src="/image/MyBatis/image23.png" alt="image23"  /></p>
<p><strong>整合实现示例</strong></p>
<ol>
<li>
<p>引入Spring配置文件spring-dao.xml</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
       <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">       http://www.springframework.org/schema/context
</span><span class="s">       http://www.springframework.org/schema/context/spring-context.xsd
</span><span class="s">       http://www.springframework.org/schema/aop
</span><span class="s">       http://www.springframework.org/schema/aop/spring-aop.xsd
</span><span class="s">       http://www.springframework.org/schema/mvc
</span><span class="s">       http://www.springframework.org/schema/mvc/spring-mvc.xsd&#34;</span><span class="nt">&gt;</span>
</code></pre></div></li>
<li>
<p>配置数据源替换MyBatis数据源</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DriverManagerDataSource&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClassName&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;777777&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div><p>如果在配置文件中写了数据库的配置的话，用以下方法配置数据源</p>
<p>db.properties</p>
<pre><code class="language-properties" data-lang="properties">driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;userUnicode=true&amp;characterEncoding=utf8
username=root
password=777777
</code></pre><p>spring-dao.xml</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;db.properties&#34;</span><span class="nt">&gt;&lt;/context:property-placeholder&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DriverManagerDataSource&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClassName&#34;</span> <span class="na">value=</span><span class="s">&#34;${driver}&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;${url}&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;${username}&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${password}&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>配置SqlSessionFactory，关联MyBatis</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSessionFactory&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>、
    <span class="c">&lt;!--关联MyBatis--&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;configLocation&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:mybatis-config.xml&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mapperLocations&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:com/heng/dao/UserMapper.xml&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>注册sqlSessionTemplate，关联sqlSessionFactory；</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionTemplate&#34;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--利用构造器注入--&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&#34;0&#34;</span> <span class="na">ref=</span><span class="s">&#34;sqlSessionFactory&#34;</span><span class="nt">&gt;&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>增加Dao接口的实现类；私有化sqlSessionTemplate</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.heng.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.spring.SqlSessionTemplate</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserMapperImpl</span> <span class="kd">implements</span> <span class="n">UserMapper</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">SqlSessionTemplate</span> <span class="n">sqlSession</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSqlSession</span><span class="o">(</span><span class="n">SqlSessionTemplate</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sqlSession</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(){</span>
        <span class="n">UserMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">UserMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>注册Bean实现</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.dao.UserDaoImpl&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">ref=</span><span class="s">&#34;sqlSession&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>测试</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">   <span class="nd">@Test</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
       <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;beans.xml&#34;</span><span class="o">);</span>
       <span class="n">UserMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="o">(</span><span class="n">UserMapper</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userDao&#34;</span><span class="o">);</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">selectUser</span><span class="o">();</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div><p><img src="/image/MyBatis/image24.png" alt="image24"  /></p>
<p>此时我们查看MyBAtis配置文件，可以发现大部分功能被整合！</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;logImpl&#34;</span> <span class="na">value=</span><span class="s">&#34;STDOUT_LOGGING&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
    <span class="nt">&lt;typeAliases&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#34;com.heng.pojo&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/typeAliases&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></li>
</ol>
<p>当然，我们还有一种整合MyBatis的方式，这种方式更加简洁，不需要管理SqlSessionTemplate，而且对事物支持更加友好</p>
<p><img src="/image/MyBatis/image25.jpg" alt="image25"  /></p>
<p>示例代码：</p>
<ol>
<li>
<p>将上述UserDaoImpl修改一下，继承SqlSessionDaoSupport类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.heng.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.heng.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.spring.SqlSessionTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.spring.support.SqlSessionDaoSupport</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserMapperImpl</span> <span class="kd">extends</span> <span class="n">SqlSessionDaoSupport</span> <span class="kd">implements</span> <span class="n">UserMapper</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(){</span>
        <span class="n">UserMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">getSqlSession</span><span class="o">().</span><span class="na">getMapper</span><span class="o">(</span><span class="n">UserMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>修改Bean的配置</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userMapper&#34;</span> <span class="na">class=</span><span class="s">&#34;com.heng.dao.UserMapperImpl&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sqlSessionFactory&#34;</span> <span class="na">ref=</span><span class="s">&#34;sqlSessionFactory&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>测试，输出结果与上面一样</p>
</li>
</ol>
<h3 id="spring事物管理">Spring事物管理</h3>
<ul>
<li>
<p>回顾事物</p>
<ul>
<li>事务在项目开发过程非常重要，涉及到数据的一致性的问题，不容马虎！</li>
<li>事务管理是企业级应用程序开发中必备技术，用来确保数据的完整性和一致性。</li>
</ul>
<p>事务就是把一系列的动作当成一个独立的工作单元，这些动作要么全部完成，要么全部不起作用</p>
</li>
<li>
<p>事务的四个特性</p>
<ol>
<li>
<p>原子性（atomicity）</p>
</li>
<li>
<p>事务是原子性操作，由一系列动作组成，事务的原子性确保动作要么全部完成，要么完全不起作用</p>
</li>
<li>
<p>一致性（consistency）</p>
</li>
<li>
<p>一旦所有事务动作完成，事务就要被提交。数据和资源处于一种满足业务规则的一致性状态中</p>
</li>
<li>
<p>隔离性（isolation）</p>
</li>
<li>
<p>可能多个事务会同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏</p>
</li>
<li>
<p>持久性（durability）</p>
</li>
<li>
<p>事务一旦完成，无论系统发生什么错误，结果都不会受到影响。通常情况下，事务的结果被写到持久化存储器中</p>
</li>
</ol>
</li>
<li>
<p>Spring中的事物管理</p>
<ul>
<li>编程式事务
<ul>
<li>将事务管理代码嵌到业务方法中来控制事务的提交和回滚</li>
<li>缺点：必须在每个事务操作业务逻辑中包含额外的事务管理代码</li>
</ul>
</li>
<li>声明式事务
<ul>
<li>一般情况下比编程式事务好用。</li>
<li>将事务管理代码从业务方法中分离出来，以声明的方式来实现事务管理。</li>
<li>将事务管理作为横切关注点，通过aop方法模块化。Spring中通过Spring AOP框架支持声明式事务管理。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>使用声明式事务代码演示</p>
<ol>
<li>
<p>头文件导入约束</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">xmlns:tx=&#34;http://www.springframework.org/schema/tx&#34;
http://www.springframework.org/schema/tx
http://www.springframework.org/schema/tx/spring-tx.xsd
</code></pre></div></li>
<li>
<p>配置事务管理器</p>
<ul>
<li><strong>无论使用Spring的哪种事务管理策略（编程式或者声明式）事务管理器都是必须的</strong>。</li>
<li>就是 Spring的核心事务管理抽象，管理封装了一组独立于技术的方法。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource &#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>配置事务通知</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tx:attributes&gt;</span>
        <span class="c">&lt;!--配置哪些方法可以使用什么样的事物，配置事务的传播特性默认为REQUIRED--&gt;</span>
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;add&#34;</span> <span class="na">propagation=</span><span class="s">&#34;REQUIRED&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;delete&#34;</span> <span class="na">propagation=</span><span class="s">&#34;REQUIRED&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;update&#34;</span> <span class="na">propagation=</span><span class="s">&#34;REQUIRED&#34;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!--为所有方法配置事务的方式--&gt;</span>
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;*&#34;</span> <span class="na">propagation=</span><span class="s">&#34;REQUIRED&#34;</span><span class="nt">&gt;&lt;/tx:method&gt;</span>
        <span class="c">&lt;!--查询方法，配置事务为只可读，保护数据--&gt;</span>
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;query&#34;</span> <span class="na">read-only=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/tx:attributes&gt;</span>
<span class="nt">&lt;/tx:advice&gt;</span>
</code></pre></div><blockquote>
<p>事务的传播特性：</p>
<p>事务传播行为就是多个事务方法相互调用时，事务如何在这些方法间传播。spring支持7种事务传播行为：</p>
<ul>
<li>propagation_requierd：如果当前没有事务，就新建一个事务，如果已存在一个事务中，加入到这个事务中，这是最常见的选择。</li>
<li>propagation_supports：支持当前事务，如果没有当前事务，就以非事务方法执行。</li>
<li>propagation_mandatory：使用当前事务，如果没有当前事务，就抛出异常。</li>
<li>propagation_required_new：新建事务，如果当前存在事务，把当前事务挂起。</li>
<li>propagation_not_supported：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</li>
<li>propagation_never：以非事务方式执行操作，如果当前事务存在则抛出异常。</li>
<li>propagation_nested：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与propagation_required类似的操作</li>
</ul>
<p>Spring 默认的事务传播行为是 PROPAGATION_REQUIRED，它适合于绝大多数的情况。</p>
</blockquote>
</li>
<li>
<p>在Spring中使用AOP的方式配置事务</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;aop:config&gt;</span>
    <span class="c">&lt;!--配置切入点--&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;txPointcut&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* com.heng.dao.*.*(..) )&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;txPointcut&#34;</span><span class="nt">&gt;&lt;/aop:advisor&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>
</code></pre></div></li>
<li>
<p>测试</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testTransaction</span><span class="o">(){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;spring-dao.xml&#34;</span><span class="o">);</span>
    <span class="n">UserMapper</span> <span class="n">userMapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userMapper&#34;</span><span class="o">,</span> <span class="n">UserMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">User</span> <span class="n">jack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">7</span><span class="o">,</span> <span class="s">&#34;jack&#34;</span><span class="o">,</span> <span class="s">&#34;111111&#34;</span><span class="o">);</span>
    <span class="n">Map</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">,</span><span class="n">3</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;陈立业&#34;</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;pwd&#34;</span><span class="o">,</span><span class="s">&#34;111111&#34;</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">addUser</span> <span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">addUser</span><span class="o">(</span><span class="n">jack</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">deleteUser</span> <span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">deleteUser</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">updateUser</span> <span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">User</span> <span class="n">user</span> <span class="o">:</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><img src="/image/MyBatis/image26.png" alt="image26"  /></p>
</li>
</ol>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ssm/">SSM</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/springmvc%E4%BA%8C/">
        
        

        <div class="article-details">
            <h2 class="article-title">SpringMVC（二）</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/springmvc%E4%B8%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">SpringMVC（一）</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/spring%E4%B8%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">Spring（一）</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/mybatis%E4%BA%8C/">
        
        

        <div class="article-details">
            <h2 class="article-title">MyBatis（二）</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/mybatis%E4%B8%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">MyBatis（一）</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src="https://utteranc.es/client.js" 
        repo="minster77/hugoblogtalks"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 MinsterBlog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.4.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#spring二">Spring（二）</a>
      <ol>
        <li><a href="#beaen的自动装配">Beaen的自动装配</a></li>
        <li><a href="#使用注解开发">使用注解开发</a></li>
        <li><a href="#aop">AOP</a></li>
        <li><a href="#整合mybatis">整合MyBatis</a></li>
        <li><a href="#spring事物管理">Spring事物管理</a></li>
      </ol>
    </li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
